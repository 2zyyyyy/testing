

## macOS下Jmeter 操作指南

以下操作是在 macOS 下进行的，windows 除了第一步安装的环境配置不同以外其他基本相同。
### 1.安装
首先确保系统安装了 homebrew，然后我们通过 homebrew 在做一个 jmeter 的下载安装（该方法比较方便，还有其他的安装方式）。
打开终端，输入命令，随后就是等待下载完成:
```bash
$ brew install jemeter
```
![image-20221110164037428](https://tva1.sinaimg.cn/large/008vxvgGly1h804g73nboj317m0u0qcz.jpg)
如果遇到以下错误信息：
```bash
fatal: not in a git directory
Error: Command failed with exit 128: git
# 这种情况就可以使用 brew -v命令 根据提示在终端输入命令即可
```
### 2.启动 Jmeter
```
# 直接终端执行 jmeter 命令即可
$ jmeter
```
jmeter启动之后默认的语言是英文，可以通过修改`jmeter.properties`文件中的 language 调整文简体中文。

![image-20221111133944118](../../../../Library/Application Support/typora-user-images/image-20221111133955283.png)

此时我们重新打开 jmeter 之后就是中文的了。

![image-20221111134056413](https://tva1.sinaimg.cn/large/008vxvgGly1h814v07qvkj30om0dsq40.jpg)


- Jmeter 常用功能
	- 接口测试
	- 压力测试
	- 分布式压力测试
- Jmeter 特性
	- 跨平台，支持 macOS、Windows、Linux（配置 Java 环境即可）
	- 支持查看 HTML 格式的测试报告
	- 支持HTML、JSON、XML 等文本格式的数据提取，满足上下游接口关联功能
	- 多线程框架允许通过多个线程进行并发采样，并通过单独的线程组同时对不同的方法进行采样
	- 可以对测试结果进行缓存和离线分析、离线重放
- Jmeter 拓展性
	-   脚本化的采样器【BeanShell、Groovy】
	-   随意增删的采样器
	-   负载统计信息可以增删定时器
	-   数据分析和可视化插件提供了出色的扩展性和个性化
	-   jmeter自带方法可以向测试计划提供动态输入或数据处理能力
	-   通过针对Maven，Gradle和Jenkins的第三方开源库轻松进行持续集成

### 3.测试计划（Test Plan）

**测试计划是什么**

- 在使用 jmeter 时，创建的一系列动作
- 完整的测试计划包含了一个或多个`线程组、逻辑控制器、采样器、监听器、定时器、断言和配置元素`

**添加测试计划的元件**

![image-20221111134837676](https://tva1.sinaimg.cn/large/008vxvgGly1h8152zyycij30ee080q38.jpg)

**删除测试计划的原件**

![image-20221111134912095](https://tva1.sinaimg.cn/large/008vxvgGly1h8153ljxusj30ax09owem.jpg)

**执行测试计划**

这里有个坑，在执行测试计划之前需要先保存创建的测试计划，但有可能会保存失败，提示一下错误：

```java
java.lang.NoClassDefFoundError: Could not initialize class org.apache.jmeter.gui.util.FileDialoger
```

解决这个错误需要以下 2 步骤：

1. 选项-语言-简体中文

   ![image-20221111141304386](https://tva1.sinaimg.cn/large/008vxvgGly1h815sd3glbj30do0bkt9b.jpg)

2. 选项-外观-Nimbus

   ![image-20221111140945653](https://tva1.sinaimg.cn/large/008vxvgGly1h815p0kiy0j30fm0913z2.jpg)

   修改完成后退出重新打开，就可以正常保存测试计划了。

   - 可视化界面（GUI）：`快捷键 ctrl+r`（不建议，当线程多 gui 会消耗大量资源导致卡死）

   - 命令行（CLI）：

     - 运行命令：`jmeter -n -t <testplan filename> -l <listener filename>`

     - 常见参数

       ![img](https://tva1.sinaimg.cn/large/008vxvgGly1h84ur6qsf2j30vd0k2dl2.jpg)

     - 停止命令：

       1. stoptest.cmd / stoptest.sh （硬中断）
       2. shutdown.cmd / shutdown.sh（软中断）

### 4.线程组（Thread Group)

![image-20221114185952846](https://tva1.sinaimg.cn/large/008vxvgGly1h84uxtjl0qj30u807ijsa.jpg)

**什么是线程组**

- 线程组是一个测试计划的开始点
- 在一个测试计划中的所有元件都必须在某个线程组下
- 线程组决定 Jmeter 执行测试计划的<font color=red>线程数</font>

**线程组的作用**

- 设置线程数
- 设置ramp-up period
- 设置执行测试的次数

每个线程都会独立的运行测试计划，互不干扰，多个线程用于模仿对服务器的并发访问。

**线程组常用参数**

![image-20221114191250421](https://tva1.sinaimg.cn/large/008vxvgGly1h84vek7w0tj31d00t4tbk.jpg)

- 在取样器错误之后要执行的动作

  - 继续（默认，建议默认）：

    - 该线程组下如果某个取样器执行失败，不会影响该线程组下的其他取样器的执行

    - 例子，将线程组的错误之后选择继续，当第二个线程发生错误之后，第三个线程也会继续执行

      ![image-20221114193649679](https://tva1.sinaimg.cn/large/008vxvgGly1h84w0fstz5j30pm0b7ab7.jpg)

  - 启动下一进程循环：当某个取样器执行失败，则当前循环下的取样器不再继续执行，进入下一次循环中执行

  - 停止线程：当某个取样器执行失败，停止当前运行的线程，进入下一个线程执行

  - 停止测试：当某个取样器执行失败，会停止当前整个线程组的执行。注意：只是影响当前正在执行的线程组，不会影响不同线程组的执行

  - 立即停止测试：当某个取样器执行失败，会立刻终止执行当前的线程组，正在执行的取样器会被中断。跟停止测试的结果非常相似，区别在于有些请求可能响应比较慢，该选项会立刻中断正在执行中请求

- 线程属性

  - 线程数：该属性实际上就是模拟了用户数量，设置了几个线程数，就相当于模拟了几个用户
  - ramp-up 时间（秒）：
    - 预期线程组的所有线程从启动-运行-释放的总时间
    - ramp up=0时，表示瞬时加压，启动线程的时间无限趋近于0
    - **特别注意：在负载测试的时候，尽量**把ramp up设置大**一些，让性能曲线平缓，容易找到瓶颈点
  - 循环次数：
    - 每个线程循环执行的次数，**默认一次（便于理解：线程的迭代次数、重复发起请求的次数）**
    - 如果设置为**永远**，那么 jmeter 将以最大的可能去发送请求，以此测试出**最大并发数**
  - same user on each iteration：每次迭代的都用同一个线程，如果勾选了，每次迭代所用的数据Cookie都一样，如果不勾选，则每次迭代去的数据不一样，保持默认即可
  - 延迟创建线程直到需要：延迟创建线程，直到线程被需要、采样器开始执行时才会被创建，避免资源浪费

- 调度器

  **调度器的作用：控制每个线程组运行的持续时间以及它在多少秒后再启动

  - **持续时间（Duration ）：持续时间；线程组运行的持续时间

  - **启动延迟（Startup Delay）：测试计划开始后，线程组的**线程**将在多少秒后**再启动运行**

    **调度器和循环次数的关系**

    - 循环次数有**固定值且 ≠ -1**，持续时间**不会生效**，以循环次数为准
    - 循环次数设置为**永远或 -1 时**，持续时间才**会生效**

- 线程属性实例：

  ![image-20221114195112989](https://tva1.sinaimg.cn/large/008vxvgGly1h84wf7yvgsj30fd09fjrn.jpg)

该线程组设置意思就是：10s 内启动并运行 10 个线程，一共启动 10 个线程，总共发送 100 个请求（10*10），每秒启动一个线程，然后运行10次。

*注意：如果 ramp-up 时间内，所有线程不能启动运行完的话，时间则会顺延下去*

- ramp-up注意点

  **足够长，Ramp-up需要设置足够长的时间来避免在测试刚开始时工作量过大**

  - 假如需要大量线程的话，不建议设置成0，0 属于瞬时加压**（过小的 ramp-up period ）**
  - 如果设置 0，Jmeter 将在**测试开始时** 就启动全部线程并 **立即发送请求**，这样很容易让服务器达到饱满状态，且瞬间会增加很大的负载量，容易让服务器超载，这样是不合理的
  - 不合理的原因并不是因为平均压力值过高，而是因为所有线程都在**初始状态时一起并发访问**，从而引起不正常的初始访问峰值，可以通过 Jmeter 的聚合报告看到这种情况

  **足够短，Ramp-up还必须足够短，保证最后一个线程在第一个线程完成之前开始运行**

  - 如果 Ramp-up 过大，则会降低访问峰值的负载，即没有达到预期的压力峰值，无法获取准确的服务器最大负载情况（过大的 ramp-up period ）
  - **具体的表现为：一些线程还没有启动，初期启动的部分线程已经结束了**（导致实际并发量并会小于预期并发量）

  **如何确定ramp-up period**

  - 首先，让初始点击率接近平均点击率，前提是确定合理的访问量
  - 初始的 ramp-up period = 平均点击率= 总线程/点击率；假如线程数=100，点击率=10次/s，则ramp-up period = 100/10 = 10s

### 测试计划参数详解
![](https://s2.loli.net/2022/11/15/mUifgOb2PwByvCA.png)
- 用户定义的变量
	全局变量，针对所有线程组都可以共用
	- 一般添加一些系统常用的配置
	- 不建议在测试计划上添加变量，因为不方便启用（disable）和禁用（enable）
	- 可以添加用户自定义变量组件来代替，如：
		![](https://s2.loli.net/2022/11/15/thJUP9DQTGdxsM6.png)
- 独立运行每个线程组（例如在一个组运行结束后启动下一个）
	- 不勾选（默认），也就是各线程组并行、随机运行
	- 勾选后，用于控制测试计划中的多个线程组的执行顺序，保证顺序执行各线程组
		*注意事项*
		- 线程组中的取样器是根据列表的顺序执行的（从上到下）
		- 交替控制器、随机控制器、随机顺序控制器、循环控制器可以改变取样器的执行顺序
- 主线程结束后运行 tearDown 线程组
- 函数测试模式
- ![](











  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  















